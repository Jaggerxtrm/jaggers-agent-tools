# Delegation Configuration
# Version: 6.0.0
# This config defines all available delegation backends and their pattern mappings.

version: 1

# ----------------------------------------------------------------------------
# CCS Profiles: Cost-optimized simple delegation
# Execute via: ccs {profile} -p "{task}"
# ----------------------------------------------------------------------------
ccs_profiles:
  glm:
    patterns:
      - "typo|spelling|fix.*typo"
      - "test|unit.*test|add.*test"
      - "doc|docstring|comment"
      - "format|lint|prettier"
      - "add.*type|type.*hint"
    cost: low
    description: "GLM-4-Flash - Fast model for tests, typos, formatting"

  gemini:
    patterns:
      - "think|analyze|reason|evaluate"
      - "architecture|entire|codebase"
      - "explain|describe|how.*work"
    cost: medium
    description: "Gemini-Flash - Reasoning and long-context analysis"

  qwen:
    patterns:
      - "quality|pattern|convention"
      - "refactor(?!.*sprint)|improve|optimize"
    cost: medium
    description: "Qwen-2.5 - Code quality and pattern detection"

# ----------------------------------------------------------------------------
# Orchestration Workflows: Direct multi-agent orchestration (Gemini + Qwen)
# Execute via: gemini -p "{prompt}" | qwen "{prompt}"
# ----------------------------------------------------------------------------
orchestration_workflows:
  parallel-review:
    patterns:
      - "review.*(code|security|quality)"
      - "code.*(review|audit|quality)"
      - "security.*(audit|review|scan)"
      - "analyze.*code|code.*analysis"
    cost: high
    description: "Multi-agent code review (Gemini proposal -> Qwen critique -> Gemini refinement)"
    pattern: collaborative  # Map to orchestration-agents patterns

  feature-design:
    patterns:
      - "implement.*(feature|endpoint|api)"
      - "create.*(feature|endpoint|api)"
      - "design.*implement"
      - "build.*feature"
    cost: high
    description: "Full development workflow (Gemini design -> Qwen implementation -> Gemini verification)"
    pattern: collaborative

  pre-commit-validate:
    patterns:
      - "validate.*(commit|staged|change)"
      - "pre.*commit|before.*commit"
      - "check.*staged"
    cost: medium
    description: "Validate staged changes (Gemini secrets check -> Qwen quality check)"
    pattern: handshake

  bug-hunt:
    patterns:
      - "debug|investigate.*bug"
      - "bug|crash|error"
      - "fix.*unknown|unknown.*error"
      - "root.*cause"
    cost: high
    description: "Root cause analysis (Gemini hypothesis -> Qwen verification -> Gemini remediation)"
    pattern: troubleshoot

  refactor-sprint:
    patterns:
      - "refactor.*sprint"
      - "major.*refactor"
      - "migrate|migration"
      - "technical.*debt"
    cost: high
    description: "Large-scale refactoring coordination (Gemini plan -> Qwen execution)"
    pattern: collaborative

  validate-last-commit:
    patterns:
      - "validate.*commit(?!.*staged)"
      - "check.*last.*commit"
      - "review.*commit"
    cost: medium
    description: "Post-commit validation (Gemini quality check -> Qwen security check)"
    pattern: handshake

# ----------------------------------------------------------------------------
# Pattern Priority: Higher priority checked first
# Orchestration workflows have priority over CCS simple tasks
# ----------------------------------------------------------------------------
priority:
  - orchestration_workflows  # Complex multi-agent tasks first
  - ccs_profiles             # Simple cost-optimized tasks second

# ----------------------------------------------------------------------------
# Default Backend: Used when no pattern matches
# ----------------------------------------------------------------------------
default:
  backend: ccs
  profile: glm
  reason: "Default cost-optimized execution"

# ----------------------------------------------------------------------------
# Exclusions: Never auto-suggest delegation for these patterns
# User can still manually invoke /delegation, but no auto-suggestion
# ----------------------------------------------------------------------------
exclusions:
  - "architecture.*decision|design.*decision"
  - "security.*critical|auth.*implementation"
  - "performance.*optimize|optimize.*performance"
  - "breaking.*change|migrate.*breaking"

# ----------------------------------------------------------------------------
# Auto-Focus Detection: Map keywords to workflow focus parameters
# Used for workflows with "focus: auto" parameter
# ----------------------------------------------------------------------------
auto_focus:
  security:
    keywords: ["security", "vulnerability", "xss", "sql", "injection", "auth"]
    workflow_params:
      parallel-review:
        focus: security

  performance:
    keywords: ["performance", "slow", "optimize", "speed", "memory", "leak"]
    workflow_params:
      parallel-review:
        focus: performance
      feature-design:
        architecturalFocus: performance

  quality:
    keywords: ["quality", "maintainability", "readability", "clean"]
    workflow_params:
      parallel-review:
        focus: quality
      feature-design:
        architecturalFocus: maintainability

# ----------------------------------------------------------------------------
# Override Flags: Command-line overrides
# Example: /delegation --glm [task] → Force CCS GLM profile
# Example: /delegation --unitai [task] → Force unitAI (auto-select workflow)
# ----------------------------------------------------------------------------
override_flags:
  # CCS profile overrides
  - flag: "--glm"
    backend: ccs
    profile: glm

  - flag: "--gemini"
    backend: ccs
    profile: gemini

  - flag: "--qwen"
    backend: ccs
    profile: qwen

  # unitAI workflow overrides
  - flag: "--unitai"
    backend: unitai
    workflow: auto  # Claude selects appropriate workflow

  - flag: "--review"
    backend: unitai
    workflow: parallel-review

  - flag: "--feature"
    backend: unitai
    workflow: feature-design

  - flag: "--validate"
    backend: unitai
    workflow: pre-commit-validate

  - flag: "--debug"
    backend: unitai
    workflow: bug-hunt

# ----------------------------------------------------------------------------
# Notes
# - Patterns are evaluated as regex (case-insensitive)
# - First matching pattern wins (respects priority order)
# - If no pattern matches, uses default backend
# - Override flags take precedence over auto-selection
# ----------------------------------------------------------------------------
