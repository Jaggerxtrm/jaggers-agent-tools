---
title: Delegating Skill
version: 1.1.0
updated: 2026-02-24
domain: skills
tracks:
  - "skills/delegating/**"
  - "hooks/skill-suggestion.py"
scope: delegating
category: ssot
changelog:
  - 1.1.0: Document tmux+PTY workaround required for CCS execution from within Claude Code.
  - 1.0.0: Initial documentation after skill hardening (v7.0.0 → hardened).
---

<!-- INDEX: auto-generated by validate_metadata.py — do not edit manually -->
| Section | Summary |
|---|---|
| [Location](#location) | Unsupported fields removed: `version`, `gemini-command`, `gemini-prompt` |
| [Frontmatter (Official Fields Only)](#frontmatter-official-fields-only) | Unsupported fields removed: `version`, `gemini-command`, `gemini-prompt` |
| [Backend Routing](#backend-routing) | CCS spawns Claude Code subprocesses |
| [CCS Execution Inside Claude Code](#ccs-execution-inside-claude-code) | CCS spawns Claude Code subprocesses |
| [Interactive Flow](#interactive-flow) | 1 |
| [Orchestration Workflows](#orchestration-workflows) | Three layers: |
| [Auto-Triggering](#auto-triggering) | Three layers: |
| [References](#references) | _no summary_ |
<!-- END INDEX -->



# Delegating Skill

Routes tasks to cost-optimized agents (CCS/GLM, Gemini, Qwen) or multi-agent orchestration (Gemini+Qwen) instead of handling them in the main Claude session.

## Location

- **Source of truth**: `skills/delegating/SKILL.md` (syncs to `~/.claude/skills/delegating/SKILL.md`)
- **Config**: `skills/delegating/config.yaml` (pattern → backend mappings)
- **References**: `skills/delegating/references/`

## Frontmatter (Official Fields Only)

```yaml
name: delegating
description: >-
  Proactively delegates tasks to cost-optimized agents before working in main session.
  MUST suggest for: tests, typos, formatting, docs, refactors, code reviews, feature
  implementation, debugging, commit validation. ...
allowed-tools: Bash
```

Unsupported fields removed: `version`, `gemini-command`, `gemini-prompt`.

## Backend Routing

| Task Pattern | Backend | Cost |
|---|---|---|
| typo, test, doc, format, lint | CCS (GLM) | LOW |
| think, analyze, reason | CCS (Gemini) | MEDIUM |
| review code/security, security audit | Orchestration | HIGH |
| implement feature, build feature | Orchestration | HIGH |
| debug, root cause, crash | Orchestration | HIGH |
| validate commit, pre-commit | Orchestration | MEDIUM |

## CCS Execution Inside Claude Code

CCS spawns Claude Code subprocesses. When `$CLAUDECODE` is set, the nested session guard blocks it. Additionally, CCS requires a **PTY** (pseudo-terminal) to render its progress output — without one, it exits silently with no output.

**Two requirements for CCS from within Claude Code:**
1. `env -u CLAUDECODE` — unsets the nested session guard
2. **tmux** — provides the PTY that CCS needs for output

**Workaround pattern:**
```bash
tmux new-session -d -s ccs_task "env -u CLAUDECODE ccs {profile} -p '{task}' > /tmp/ccs_out.txt 2>&1"
sleep 30  # or poll until session exits
cat /tmp/ccs_out.txt
```

Note: `env -u CLAUDECODE ccs {profile} -p "{task}"` alone (no tmux) exits silently — no output, no error.

**Gemini and Qwen** are standalone CLIs; they do not wrap `claude`, require no PTY, and work directly via Bash.

Confirmed: parent session survives, GLM-4.7 responds correctly (tested 2026-02-24).

## Interactive Flow

1. `AskUserQuestion` — "Delegate or work in main session?"
2. If delegate → `AskUserQuestion` — backend selection (Auto / GLM / Gemini / Qwen / Orchestration)
3. Execute via appropriate CLI:
   - CCS: tmux + `env -u CLAUDECODE ccs {profile} -p '{task}' > /tmp/ccs_out.txt 2>&1` (see CCS Execution section)
   - Gemini: `gemini -p "{task}"`
   - Qwen: `qwen "{task}"`
   - Orchestration: sequential gemini/qwen turns per workflow protocol

## Orchestration Workflows

| Workflow | Protocol |
|---|---|
| handshake | Gemini proposes → Qwen validates (1 turn each) |
| collaborative | Gemini designs → Qwen critiques → Gemini refines (3 turns) |
| troubleshoot | Gemini hypothesis → Qwen verify → Gemini root cause → synthesis (4 turns) |

## Auto-Triggering

Three layers:
1. **`skillSuggestions.enabled: true`** in `settings.json` — UI suggestion chips
2. **Description keywords** — auto-loads SKILL.md when prompt matches
3. **`skill-suggestion.py` UserPromptSubmit hook** — injects system_message reminder

## References
- `skills/delegating/SKILL.md`
- `skills/delegating/config.yaml`
- `hooks/skill-suggestion.py`
- `~/.ccs/.claude/skills/ccs-delegation/SKILL.md` (CCS subprocess context, separate)
