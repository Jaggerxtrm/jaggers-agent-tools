---
title: "Project Documentation Workflow"
version: 2.0.0
created: 2026-02-03
updated: 2026-02-24
scope: jaggers-agent-tools
category: ssot
subcategory: workflow
domain: [documentation, ssot, changelog, claude-md]
tracks:
  - "skills/documenting/**"
status: active
changelog:
  - version: 2.0.0
    date: 2026-02-24
    changes: >
      Full rewrite — drift-first workflow with drift_detector.py, tracks: frontmatter,
      intra-memory INDEX auto-generation, Stop hook, SKILL.md decision table.
  - version: 1.0.0
    date: 2026-02-03
    changes: Initial documentation of the project-wide documentation update workflow.
---

<!-- INDEX: auto-generated by validate_metadata.py — do not edit manually -->
| Section | Summary |
|---|---|
| [Core Documentation Artifacts](#core-documentation-artifacts) | The five artifact types maintained in this project |
| [Workflow — Invoke /documenting](#workflow--invoke-documenting) | Drift-first 5-step protocol |
| [Drift Detection](#drift-detection) | How tracks: and drift_detector.py work together |
| [Memory Structure](#memory-structure) | Frontmatter schema and INDEX block format |
| [Auto-Trigger — Stop Hook](#auto-trigger--stop-hook) | Session-end hook that surfaces stale memories |
| [Standards](#standards) | Naming, versioning, and validation rules |
| [Related Documentation](#related-documentation) | Links to skill and script files |
<!-- END INDEX -->

# Project Documentation Workflow — SSOT

## Core Documentation Artifacts

| Artifact | Location | Purpose |
|---|---|---|
| **Changelog** | `CHANGELOG.md` | Public record of all changes and versions |
| **README** | `README.md` | User-facing entry point and installation guide |
| **CLAUDE.md** | `CLAUDE.md` | Agent-facing technical reference and architecture |
| **SSOT Memories** | `.serena/memories/` | Deep technical knowledge base, one file per domain |
| **Skill Docs** | `skills/<skill>/SKILL.md` | Workflow instructions for the agent |

---

## Workflow — Invoke /documenting

The `/documenting` skill runs a drift-first 5-step protocol. See `skills/documenting/SKILL.md` for the full decision table.

### Step 1 — Detect drift
```bash
python3 "$HOME/.claude/skills/documenting/scripts/drift_detector.py" scan
```
Stop early if nothing is stale and no explicit documentation request was made.

### Step 2 — Decide action

| Situation | Action |
|---|---|
| New feature shipped | Create new SSOT or update existing |
| Refactor / architecture change | Update SSOT, bump minor version |
| Bug fix only | CHANGELOG entry only |
| SKILL.md drift flagged | Update skill, re-validate |

### Step 3 — Create or update memory

**Create:**
```bash
python3 "$HOME/.claude/skills/documenting/scripts/generate_template.py" \
  ssot <name>.md title="..." domain="..." subcategory="..."
```
Fill `[PENDING]` markers. Set `tracks:` globs.

**Update:** Read the `<!-- INDEX -->` block first (~20 lines). Use `search_for_pattern` to jump to stale sections. Bump `version:` and `updated:`.

### Step 4 — Regenerate INDEX
```bash
python3 "$HOME/.claude/skills/documenting/scripts/validate_metadata.py" <file>
```

### Step 5 — Update CHANGELOG
```bash
python3 "$HOME/.claude/skills/documenting/scripts/changelog/add_entry.py" \
  <changelog_file> <type> "<summary>"
```

---

## Drift Detection

Each memory has a `tracks:` field in its YAML frontmatter listing glob patterns for the files it documents:

```yaml
tracks:
  - "cli/src/**/*.ts"
  - "hooks/**/*.py"
```

`drift_detector.py` cross-checks these globs against `git log --name-only` output using proper `**` segment matching. A memory is flagged stale if any of its tracked files were modified more recently than its `updated:` date.

**Subcommands:**
- `scan [--since N]` — scan all memories (default last 30 commits)
- `check <name>` — check a single memory
- `hook` — Stop hook mode: outputs JSON `additionalContext` reminder only when stale

---

## Memory Structure

### Frontmatter schema (key fields)

```yaml
title: "..."
version: 1.0.0
updated: YYYY-MM-DD
domain: "..."          # string or list
tracks:                # list of fnmatch globs
  - "src/**/*.py"
changelog:
  - version: 1.0.0
    date: YYYY-MM-DD
    changes: "..."
```

### INDEX block

Auto-generated by `validate_metadata.py` after every validation run. Placed immediately after the frontmatter `---`. Agent reads only the INDEX (~15 lines) to understand memory structure, then uses `search_for_pattern` to jump to specific sections.

```
<!-- INDEX: auto-generated by validate_metadata.py — do not edit manually -->
| Section | Summary |
|---|---|
| [Architecture](#architecture) | One-line summary from first prose sentence |
<!-- END INDEX -->
```

**Rules:**
- Generated from all `##` headings (not `###`)
- Summary = first non-code, non-table, non-list sentence in each section (max 120 chars)
- Generation is unconditional — runs even when schema validation fails

---

## Auto-Trigger — Stop Hook

`config/settings.json` contains a Stop hook:

```json
"Stop": [{"hooks": [{"type": "command",
  "command": "python3 \"$HOME/.claude/skills/documenting/scripts/drift_detector.py\" hook",
  "timeout": 5}]}]
```

Behaviour: checks session-written files (git diff HEAD + staged) against all `tracks:` globs. Outputs a one-line `additionalContext` reminder only when matches found. **Zero token cost when nothing is stale.**

---

## Standards

- **Naming**: memories use `ssot_<domain>_<topic>_YYYY-MM-DD.md` prefix convention
- **Versioning**: patch = content fix, minor = new section, major = full rewrite
- **`tracks:` required** on all new memories for drift detection to work
- **Validation**: `validate_metadata.py` warns on missing schema fields but always regenerates INDEX
- **Tests**: `PYTHONPATH=skills/documenting python -m pytest skills/documenting/tests/`

---

## Related Documentation

- `skills/documenting/SKILL.md` — agent workflow instructions (drift-first, decision table)
- `skills/documenting/scripts/drift_detector.py` — scan/check/hook subcommands
- `skills/documenting/scripts/validate_metadata.py` — validation + INDEX generation
- `skills/documenting/scripts/generate_template.py` — memory template generation
- `skills/documenting/tests/` — 23 tests covering drift_detector and validate_metadata
