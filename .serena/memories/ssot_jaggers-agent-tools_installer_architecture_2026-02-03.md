---
title: "Installer and Sync Architecture"
version: 1.3.0
created: 2026-02-03
updated: 2026-02-25
scope: jaggers-config-manager
category: ssot
subcategory: installer
domain: [infrastructure, cli, sync, gemini, claude, npx]
tracks:
  - "cli/**"
  - "config/**"
status: active
changelog:
  - version: 1.0.0
    date: 2026-01-31
    changes: Initial implementation of the Config Manager CLI.
  - version: 1.1.0
    date: 2026-02-03
    changes: Added zero-cloning support, Gemini command sync, and auto-generation.
  - version: 1.1.1
    date: 2026-02-03
    changes: Implemented dynamic path resolution in sync logic to fix hardcoded paths in settings.json.
  - version: 1.3.0
    date: 2026-02-25
    changes: GitNexus integration. add-optional.ts supports _notes.install_cmd (auto-installs npm packages with ora spinner) and _notes.post_install_message (post-sync guidance banner). Hook and skills now synced via standard pipeline.
  - version: 1.2.0
    date: 2026-02-21
    changes: Full TypeScript migration. Commander.js sub-commands (sync/status/reset). Adapter pattern. Rollback protection. Zod schemas. Windows compatibility baked in.
---

<!-- INDEX: auto-generated by validate_metadata.py — do not edit manually -->
| Section | Summary |
|---|---|
| [Overview](#overview) | The Jaggers Agent Tools installer (`jaggers-config-manager`) is a Node |
| [Distribution Models](#distribution-models) | The suite is distributed as a self-installing package via `npx` |
| [Architecture (v1.2.0 — TypeScript)](#architecture-v1.2.0-—-typescript) | The CLI is now a fully typed TypeScript package compiled with `tsup` |
| [Standards & Best Practices](#standards-&-best-practices) | 1 |
| [Optional Server Auto-Install Pattern (v1.3.0)](#optional-server-auto-install-pattern-v1.3.0) | `cli/src/commands/add-optional |
| [Related Documentation](#related-documentation) | _no summary_ |
<!-- END INDEX -->



# Installer and Sync Architecture - SSOT

## Overview

The Jaggers Agent Tools installer (`jaggers-config-manager`) is a Node.js-based CLI designed to synchronize skills, hooks, and configuration across multiple agent environments (Claude Code and Gemini CLI).

## Distribution Models

### 1. Zero-Cloning (Primary Method)
The suite is distributed as a self-installing package via `npx`. This ensures that all users receive the latest skills, hooks, and commands without manual repository management.
- **Command**: `npx -y github:Jaggerxtrm/jaggers-agent-tools`
- **Mechanism**: `npm` fetches the repository, installs dependencies in a temporary cache, and executes the `bin` entry point defined in the root `package.json`.

### 2. Local Development Sync
Used for developing new tools or manual synchronization of a cloned repository.
- **Command**: `npx ./cli`

## Architecture (v1.2.0 — TypeScript)

The CLI is now a fully typed TypeScript package compiled with `tsup`. Entry: `cli/dist/index.js`.

### Sub-commands (Commander.js)
- `jaggers-config sync [--dry-run] [-y] [--prune] [--backport]`
- `jaggers-config status` — read-only diff
- `jaggers-config reset` — clear saved preferences

### Adapter Pattern (`cli/src/adapters/`)
- `ToolAdapter` abstract base class
- `ClaudeAdapter`, `GeminiAdapter`, `QwenAdapter` implementations
- `detectAdapter(systemRoot)` factory with Windows path normalization

### Core Modules (`cli/src/core/`)
- `context.ts` — environment detection and target selection
- `diff.ts` — MD5-based changeset calculation (missing/outdated/drifted)
- `sync-executor.ts` — file copy/symlink with rollback protection
- `manifest.ts` — `.jaggers-sync-manifest.json` read/write
- `rollback.ts` — backup/restore for atomic operations

### Utils (`cli/src/utils/`)
- `hash.ts` — MD5 file/directory hashing
- `atomic-config.ts` — deep merge with protected key preservation
- `config-adapter.ts` — cross-agent format transforms + Windows path fix
- `env-manager.ts` — `~/.config/jaggers-agent-tools/.env` management
- `sync-mcp-cli.ts` — native `mcp add/remove` via agent CLIs
- `transform-gemini.ts` — SKILL.md → Gemini `.toml` command generation

### Type Definitions (`cli/src/types/`)
- `config.ts` — Zod schemas: `SyncMode`, `ChangeSet`, `Manifest`
- `models.ts` — shared interfaces: `Skill`, `Hook`, `MCPServer`

## Standards & Best Practices

1. **Safety First**: Always creates backups (`.bak`) of configuration files before overwriting.
2. **Platform Neutrality**: Uses forward slashes and cross-platform path resolution for Windows/Linux/macOS compatibility.
3. **Transparency**: Explicitly displays a breakdown of `[+] Missing`, `[^] Outdated`, and `[<] Drifted` items before execution.

## Optional Server Auto-Install Pattern (v1.3.0)

`cli/src/commands/add-optional.ts` supports automatic prerequisite installation for optional MCP servers.

**Metadata fields** (in `config/mcp_servers_optional.json` → `_notes`):
- `install_cmd`: shell command to run before MCP add (e.g. `npm install -g gitnexus`)
- `post_install_message`: message printed after sync under a yellow "⚠️ Next Steps Required" banner

**Flow in `add-optional.ts`:**
1. User selects server(s) from interactive menu
2. For each selected server with `install_cmd`: run via `execSync` with `ora` spinner
3. Run `claude/gemini/qwen mcp add` for each selected server
4. Print all `post_install_message` values at the end

**Current servers with auto-install:** `gitnexus` (`npm install -g gitnexus`)

## Related Documentation

- `ssot_jaggers-agent-tools_documenting_workflow_2026-02-03.md` - Documentation standards.
- `ssot_jaggers-agent-tools_orchestrating_agents_2026-02-03.md` - Orchestration skill architecture.
- `ssot_cli_mcp_servers_2026-02-21.md` - MCP servers configuration and sync.
